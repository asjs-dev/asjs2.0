;function Config(){return createSingletonClass(Config,this,ASJS.AbstractModel);};function JSONLoader(){return createClass(this,ASJS.Loader,null,function(scp,spr){scp.new=function(){scp.responseType="json";}});};function DataProxy(){return createSingletonClass(DataProxy,this,Object,null,function(scp,spr){scp.loadJSON=function(url){var dfd=new ASJS.Deferred();var loader=new JSONLoader();loader.method=ASJS.RequestMethod.GET;loader.addEventListener(ASJS.LoaderEvent.LOAD,function(e){dfd.resolve(loader.content);});loader.addEventListener(ASJS.LoaderEvent.ERROR,function(e){dfd.reject(loader.content);});loader.load(url);return dfd.promise;};scp.loadAnimation=function(url){return(new ASJS.AnimationLoader()).load(url);}});};function ConfigLoaderCommand(){return createClass(this,ASJS.AbstractCommand,null,function(scp,spr){var _config=new Config();var _dataProxy=new DataProxy();scp.execute=function(){var promise=_dataProxy.loadJSON("json/config.json");promise.resolve(function(response){_config.data=response;});return promise;}});};function Language(){return createSingletonClass(Language,this,ASJS.AbstractModel,null,function(scp,spr){var _languageItems={};var _supportedLanguages;var _selectedLanguage;prop(scp,"supportedLanguages",{get:function(){return _supportedLanguages;}});prop(scp,"data",{set:function(v){spr.data=v.elements;_supportedLanguages=v.supported_languages;_selectedLanguage=v.default_language;}});prop(scp,"selectedLanguage",{get:function(){return _selectedLanguage;},set:function(v){_selectedLanguage=v;}});scp.getText=function(k){var i=scp.get(k);return i!=null&&i[scp.selectedLanguage]!=undefined?i[scp.selectedLanguage]:"";};scp.genText=function(str){for(var k in scp.data)str=str.split("{{"+k+"}}").join(scp.getText(k));return str;}});};function LanguageLoaderCommand(){return createClass(this,ASJS.AbstractCommand,null,function(scp,spr){var _language=new Language();var _dataProxy=new DataProxy();scp.execute=function(){var promise=_dataProxy.loadJSON("json/language.json");promise.resolve(function(response){_language.data=response;});return promise;}});};var Tools={};roFunc(Tools,"replaceText",function(s,o){var r=/{{.*?}}/g;var rt=s;var m;while((m=r.exec(s))!==null){if(m.index===r.lastIndex)r.lastIndex++;var e=m[0].split("{{").join("").split("}}").join("");var c=Tools.ref(o,e);rt=rt.replace(m[0],c!=null?c:m[0]);};return rt;});roFunc(Tools,"ref",function(o,s){return s.split(".").reduce(function(o,x){return o[x];},o);});roFunc(Tools,"isValidEmailAddress",function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);});roFunc(Tools,"getURLParams",function(param){var url=decodeURIComponent(new ASJS.Window().location.href).split("#");if(url[1]==''||url[1]==undefined)return[];var params=url[1].split('&');var i=-1;var l=params.length;var urlParams={};while(++i<l){var line=params[i].split('=');urlParams[line[0]]=line[1];};return urlParams[param];});roFunc(Tools,"createUrlParams",function(params,reload){var url="";for(var k in params){if(url!="")url+="&";url+=k+"="+params[k];};new ASJS.Window().location.href='#'+url;if(reload)Tools.reload();});roFunc(Tools,"reload",function(){new ASJS.Window().location.reload(true);});function Cookies(){return createSingletonClass(Cookies,this,Object,null,function(scp,spr){scp.createCookie=function(n,v,d){if(d){var date=new Date();date.setTime(date.getTime()+(d*86400000));var expires="; expires="+date.toGMTString();}else var expires="";document.cookie=n+"="+v+expires+"; path=/";try{if(typeof(Storage)!=="undefined")localStorage[n]=v;}catch(e){trace(e);}};scp.readCookie=function(n){var nameEQ=n+"=";var ca=document.cookie.split(';');var i=-1;var l=ca.length;while(++i<l){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);};try{if(typeof(Storage)!=="undefined")return localStorage[n];}catch(e){trace(e);};return null;};scp.eraseCookie=function(n){scp.createCookie(n,"",-1);try{if(typeof(Storage)!=="undefined")delete localStorage[n];}catch(e){trace(e);}}});};function EnvironmentCommand(){return createClass(this,ASJS.AbstractCommand,null,function(scp,spr){var _window=new ASJS.Window();var _language=new Language();var _cookies=new Cookies();var _cycler=new ASJS.Cycler();var _config=new Config();var _sleepToResizeId;scp.execute=function(){setupLanguage();setupCycler();setupStage();};function setupLanguage(){var selectedLanguage=Tools.getURLParams('lang');if(selectedLanguage==undefined||_language.supportedLanguages.indexOf(selectedLanguage)==-1)selectedLanguage=_cookies.readCookie('language');if(selectedLanguage==undefined||_language.supportedLanguages.indexOf(selectedLanguage)==-1)selectedLanguage=_language.selectedLanguage;_language.selectedLanguage=selectedLanguage;_cookies.createCookie('language',_language.selectedLanguage);stage.title=_language.getText("title");};function setupCycler(){_cycler.fps=_config.get("fps");_cycler.start();};function setupStage(){stage.addEventListener(ASJS.Stage.RESIZE,onStageResize);};function onStageResize(){_sleepToResizeId=_window.clearTimeout(_sleepToResizeId);_sleepToResizeId=_window.setTimeout(onTimeout,_config.get("resizeInterval"));};function onTimeout(){_sleepToResizeId=_window.clearTimeout(_sleepToResizeId);scp.sendNotification(ASJS.Stage.RESIZE);}});};function AbstractResizeMediator(view){return createClass(this,ASJS.AbstractMediator,null,function(scp,spr){scp._handlers=[ASJS.Stage.RESIZE];scp.reciveNotification=function(type,data){switch(type){case ASJS.Stage.RESIZE:scp._onResize();break;}};scp._onResize=function(){}});};function AbstractView(){return createClass(this,ASJS.Sprite,null,function(scp,spr){var _easingTarget={alpha:0};var _easing=new ASJS.Easing();scp.new=function(){scp.addEventListener(ASJS.Stage.ADDED_TO_STAGE,addedToStage);};scp._animateTo=function(to,completeCallback){_easingTarget={alpha:scp.alpha};_easing.stop();_easing.play(_easingTarget,{alpha:to},1000,"easeInOutExpo",function(){scp.alpha=_easingTarget.alpha;},completeCallback);};function addedToStage(){scp.alpha=0;scp._animateTo(1);}});};function ContentView(){return createClass(this,AbstractView,null,function(scp,spr){var priv={};cnst(priv,"ANIMATION_EXPLODE_ID","animationExplode");cnst(priv,"ANIMATION_FIREWORKS_ID","animationFireworks");var _language=new Language();var _mouse=new ASJS.Mouse();var _background=new ASJS.Sprite();var _box=new ASJS.Sprite();var _label=new ASJS.Label();var _button=new ASJS.Button();var _animatedSprite=new ASJS.AnimatedSprite();var _drag=false;scp.new=function(){scp.addEventListener(ASJS.Stage.ADDED_TO_STAGE,addedToStage);};scp.drawNow=function(){_background.setSize(stage.stageWidth,stage.stageHeight);_box.x=(stage.stageWidth-_box.width)*0.5;};scp.init=function(data){_background.addClass("background");_background.setCSS("position","fixed");_background.alpha=0.5;scp.addChild(_background);_box.addClass("box");_box.setSize(320,130);_box.y=100;scp.addChild(_box);_label.text=_language.getText("new_asjs_base_site");_label.addClass("box_label");_label.setSize(320,30);_label.move(0,34);_box.addChild(_label);_button.label=_language.getText("show_notification_window");_button.addClass("box_button");_button.setSize(320,40);_button.move(0,_box.height-_button.height);_button.addEventListener(ASJS.MouseEvent.CLICK,onButtonClick);_box.addChild(_button);_animatedSprite.addAnimationDescriptorList(data);_animatedSprite.move(10,10);scp.addChild(_animatedSprite);_animatedSprite.addEventListener(ASJS.MouseEvent.CLICK,onAnimatedSpriteClick);_animatedSprite.addEventListener(ASJS.MouseEvent.MOUSE_DOWN+" "+ASJS.MouseEvent.TOUCH_START,onAnimatedSpriteMouseDown);stage.addEventListener(ASJS.MouseEvent.MOUSE_UP+" "+ASJS.MouseEvent.TOUCH_END,onDragStop);stage.addEventListener(ASJS.MouseEvent.MOUSE_LEAVE,onDragStop);stage.addEventListener(ASJS.MouseEvent.MOUSE_MOVE+" "+ASJS.MouseEvent.TOUCH_MOVE,onStageMouseMove);scp.addEventListener(ASJS.MouseEvent.CLICK,onMouseClick);scp.drawNow();};function addedToStage(){playFireworksAnimation();};function onButtonClick(){scp.dispatchEvent(ContentMediator.ON_SHOW_NOTIFICATION_WINDOW_CLICK);};function playExplodeAnimation(){if(!_animatedSprite)return;_animatedSprite.setSize(256,128);_animatedSprite.play(priv.ANIMATION_EXPLODE_ID,ASJS.AnimatedSprite.PLAY_REVERSE);};function playFireworksAnimation(){if(!_animatedSprite)return;_animatedSprite.setSize(200,200);_animatedSprite.play(priv.ANIMATION_FIREWORKS_ID);};function onAnimatedSpriteClick(){if(_animatedSprite.selectedAnimation==priv.ANIMATION_FIREWORKS_ID)playExplodeAnimation();else playFireworksAnimation();};function onAnimatedSpriteMouseDown(){_drag=true;};function onDragStop(){_drag=false;};function onStageMouseMove(){scp.filters=[new ASJS.BlurFilter((Math.max(0,stage.stageHeight/(stage.stageHeight-_mouse.mouseY))/10))];if(!_drag)return;_animatedSprite.move(_mouse.mouseX-_animatedSprite.width*0.5,_mouse.mouseY-_animatedSprite.height*0.5);};function onMouseClick(){var hitTest=_box.hitTest(new ASJS.Point(_mouse.mouseX,_mouse.mouseY));_label.text=_language.getText(hitTest?"hit_test_inside":"hit_test_outside");}});};function NotificationWindowView(){return createClass(this,AbstractView,null,function(scp,spr){var _notificationItem={};var _window=new ASJS.Scale9Grid();var _title=new ASJS.Sprite();var _content=new ASJS.Sprite();var _okButton=new ASJS.Button();var _cancelButton=new ASJS.Button();scp.new=function(){scp.setCSS("background-color","rgba( 0, 0, 0, 0.4 )");scp.setCSS("position","fixed");_window.size=new ASJS.Point(30,80);_window.rect=new ASJS.Rectangle(13,60,4,7);_window.backgroundImage="images/window.png";scp.addChild(_window);_title.height=50;_title.setCSS("line-height",_title.height+"px");_title.addClass("notification_title");scp.addChild(_title);_content.addClass("notification_content");scp.addChild(_content);_okButton.addEventListener(ASJS.MouseEvent.CLICK,function(){scp.hideWindow();if(_notificationItem['okCallback']!=undefined)_notificationItem['okCallback']();});drawButtonStyle(_okButton);_cancelButton.addEventListener(ASJS.MouseEvent.CLICK,function(){scp.hideWindow();if(_notificationItem['cancelCallback']!=undefined)_notificationItem['cancelCallback']();});drawButtonStyle(_cancelButton);};scp.hideWindow=function(){scp._animateTo(0,function(){scp.dispatchEvent(NotificationWindowMediator.HIDE);_title.html="";_content.html="";if(hasOkButton())scp.removeChild(_okButton);_okButton.label="";if(hasCancelButton())scp.removeChild(_cancelButton);_cancelButton.label="";});};scp.showWindow=function(notificationItem){_notificationItem=notificationItem;_title.html=_notificationItem.title;_content.html=_notificationItem.content;if(_notificationItem['showOk']){_okButton.label=_notificationItem['okLabel'];if(!hasOkButton())scp.addChild(_okButton);}else if(hasOkButton())scp.removeChild(_okButton);if(_notificationItem['showCancel']){_cancelButton.label=_notificationItem['cancelLabel'];if(!hasCancelButton())scp.addChild(_cancelButton);}else if(hasCancelButton())scp.removeChild(_cancelButton);};scp.drawNow=function(){scp.setSize(stage.stageWidth,stage.stageHeight);_window.setSize(Math.max(150,Math.min(stage.stageWidth,_notificationItem.width)),Math.max(150,Math.min(stage.stageHeight,_notificationItem.height)));_window.move((stage.stageWidth-_window.width)*0.5,Math.max(0,(stage.stageHeight-_window.height)*0.5));_window.drawNow();_title.move(_window.x+25,_window.y+10);_title.width=_window.width-50;_content.move(_title.x,_title.y+_title.height+25);_content.setSize(_title.width,_window.height-_title.height-55-(hasOkButton()||hasCancelButton()?60:0));if(_content.drawNow)_content.drawNow();_okButton.width=_window.width*0.5-20;if(hasOkButton()){_okButton.x=_window.x+(hasCancelButton()?_window.width*0.5-10-_okButton.width:((_window.width-_okButton.width)*0.5));_okButton.y=_window.y+_window.height-_okButton.height-30;};_cancelButton.width=_okButton.width;if(hasCancelButton()){_cancelButton.x=_window.x+(hasOkButton()?_window.width*0.5+10:((_window.width-_cancelButton.width)*0.5));_cancelButton.y=_window.y+_window.height-_cancelButton.height-30;}};function hasOkButton(){return scp.contains(_okButton);};function hasCancelButton(){return scp.contains(_cancelButton);};function drawButtonStyle(target){target.addClass("notification_button");target.height=42;}});};function NotificationWindowDataVo(){return createClass(this,Object,null,function(scp,spr){scp.title="";scp.content="";scp.showOk=true;scp.showCancel=false;scp.okCallback=null;scp.cancelCallback=null;scp.okLabel=null;scp.cancelLabel=null;scp.width=500;scp.height=200;});};function NotificationWindowMediator(view){return createClass(this,AbstractResizeMediator,null,function(scp,spr){scp._handlers.push(NotificationWindowMediator.SHOW);var _pool=[];var _showed=false;var _defaultOkLabel="";var _defaultCancelLabel="";var _notificationWindowView=new NotificationWindowView();scp.new=function(){_notificationWindowView.addEventListener(NotificationWindowMediator.HIDE,hide);};scp.reciveNotification=function(type,data){spr.reciveNotification(type,data);switch(type){case NotificationWindowMediator.SHOW:show(data);break;}};scp.setDefault=function(okLabel,cancelLabel){_defaultOkLabel=okLabel;_defaultCancelLabel=cancelLabel;};scp._onResize=function(){if(scp._view.contains(_notificationWindowView))_notificationWindowView.drawNow();};function show(data){if(data==undefined)data=new NotificationDataVo();if(!data.okLabel)data.okLabel=_defaultOkLabel;if(!data.cancelLabel)data.cancelLabel=_defaultCancelLabel;_pool.push(data);if(!_showed)showWindow();};function hide(){if(_pool.length>0)showWindow();else hideWindow();};function hideWindow(){scp._view.removeChild(_notificationWindowView);_showed=false;};function showWindow(){var notificationItem=_pool[0];_pool.shift();_showed=true;_notificationWindowView.showWindow(notificationItem);if(!scp._view.contains(_notificationWindowView))scp._view.addChild(_notificationWindowView);scp._onResize();}});};cnst(NotificationWindowMediator,"SHOW","NotificationWindowMediator-show");cnst(NotificationWindowMediator,"HIDE","NotificationWindowMediator-hide");function ContentMediator(view){return createClass(this,AbstractResizeMediator,null,function(scp,spr){scp._handlers.push(ContentMediator.SHOW);var _dataProxy=new DataProxy();var _language=new Language();var _contentView=new ContentView();scp.reciveNotification=function(type,data){spr.reciveNotification(type,data);switch(type){case ContentMediator.SHOW:onShow();break;}};scp._onResize=function(){if(scp._view.contains(_contentView))_contentView.drawNow();};function onLoadAnimation(data){_contentView.init(data);scp._view.addChild(_contentView);};function onShow(){_contentView.addEventListener(ContentMediator.ON_SHOW_NOTIFICATION_WINDOW_CLICK,function(){var notificationWindowDataVo=new NotificationWindowDataVo();notificationWindowDataVo.title=_language.getText("notification_title");notificationWindowDataVo.content=_language.getText("notification_content");notificationWindowDataVo.height=230;scp.sendNotification(NotificationWindowMediator.SHOW,notificationWindowDataVo);});_dataProxy.loadAnimation("json/animation/contentAnimation.json").resolve(onLoadAnimation);scp._onResize();}});};cnst(ContentMediator,"SHOW","ContentMediator-show");cnst(ContentMediator,"ON_SHOW_NOTIFICATION_WINDOW_CLICK","ContentMediator-onShowNotificationWindowClick");function ViewPrepCommand(){return createClass(this,ASJS.AbstractCommand,null,function(scp,spr){var _language=new Language();scp.execute=function(app){new ContentMediator(app.contentView);var notificationWindowMediator=new NotificationWindowMediator(app.notificationWindowView);notificationWindowMediator.setDefault(_language.getText('notification_ok_button'),_language.getText('notification_cancel_button'));}});};function StartupCommand(){return createClass(this,ASJS.AbstractCommand,null,function(scp,spr){var _app;scp.execute=function(app){_app=app;loadConfig();};function loadConfig(){(new ConfigLoaderCommand()).execute().resolve(loadLanguage);};function loadLanguage(){(new LanguageLoaderCommand()).execute().resolve(initApplication);};function initApplication(){(new EnvironmentCommand()).execute();(new ViewPrepCommand()).execute(_app);scp.sendNotification(ContentMediator.SHOW);}});};function Application(){return createClass(this,Object,null,function(scp,spr){var _contentView=new ASJS.Sprite();var _notificationWindowView=new ASJS.Sprite();scp.new=function(){trace("<AS/JS> 2.0 Application");stage.addChild(scp.contentView);stage.addChild(scp.notificationWindowView);(new StartupCommand()).execute(scp);};prop(scp,"contentView",{get:function(){return _contentView;}});prop(scp,"notificationWindowView",{get:function(){return _notificationWindowView;}});});};ASJS.start(Application);